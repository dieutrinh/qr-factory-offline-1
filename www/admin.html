<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>QR Factory V2 ‚Äî Admin</title>
<style>
body{margin:0;background:#071022;color:#d7e2ff;font:14px system-ui}
.wrap{padding:18px;max-width:1200px;margin:auto}
.card{background:#0b1a33;border-radius:18px;padding:16px}
input,button{padding:10px;border-radius:10px;border:none}
button{background:#2f6bff;color:white;font-weight:600;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border-bottom:1px solid #1e3566;padding:8px;text-align:left}
a{color:#9fb8ff}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<h2>üõ† Admin Dashboard</h2>
<a href="./index.html">‚Üê Generate</a>

<div style="margin:12px 0;display:flex;gap:10px">
  <input id="q" placeholder="T√¨m code / product / batch..." style="flex:1">
  <button onclick="load()">Reload</button>
</div>

<table>
<thead>
<tr>
<th>Code</th><th>Product</th><th>Batch</th>
<th>MFG</th><th>EXP</th><th>Status</th><th>Updated</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script>
const $ = id => document.getElementById(id);

async function apiGet(url){
  if (window.qrFactory?.apiGet) return await window.qrFactory.apiGet(url);
  const r = await fetch(url); return await r.json();
}

async function load(){
  const q = $("q").value || "";
  const r = await apiGet(`/api/products?q=${encodeURIComponent(q)}`);
  const rows = r.rows || [];
  $("tbody").innerHTML = rows.map(x => `
    <tr>
      <td><a href="./qr.html?token=${x.code}">${x.code}</a></td>
      <td>${x.product_name}</td>
      <td>${x.batch_serial}</td>
      <td>${x.mfg_date}</td>
      <td>${x.exp_date}</td>
      <td>${x.status}</td>
      <td>${x.updated_at||""}</td>
    </tr>
  `).join("");
}

$("q").addEventListener("input", load);
load();
</script>
</body>
</html>
