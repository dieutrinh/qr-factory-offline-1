<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QR Factory V2 ‚Äî Scan</title>
  <style>
    :root{--bg:#071022;--panel:#0b1a33;--panel2:#0a1630;--txt:#d7e2ff;--muted:#92a6d6;--line:#1e3566;--err:#ff8f8f;}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font:14px/1.5 system-ui,Segoe UI,Arial}
    .wrap{max-width:900px;margin:20px auto;padding:16px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:18px;padding:18px}
    a{color:#9ec1ff;text-decoration:none} a:hover{text-decoration:underline}
    .err{color:var(--err)}
    .grid{display:grid;grid-template-columns:160px 1fr;gap:10px;margin-top:12px}
    .k{color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>üì≤ Scan Result</h2>
    <div><a href="./index.html">‚Üê Generate</a> ‚Ä¢ <a href="./admin.html">Admin</a></div>
    <div id="msg" class="err" style="margin-top:10px"></div>

    <div class="grid">
      <div class="k">Token/Code</div><div id="code">-</div>
      <div class="k">Product</div><div id="product">-</div>
      <div class="k">Batch</div><div id="batch">-</div>
      <div class="k">MFG</div><div id="mfg">-</div>
      <div class="k">EXP</div><div id="exp">-</div>
      <div class="k">Note</div><div id="note">-</div>
      <div class="k">Status</div><div id="status">-</div>
      <div class="k">Updated</div><div id="updated">-</div>
    </div>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const qp = new URLSearchParams(location.search);
const token = qp.get("token") || "";

async function run(){
  if(!token){
    $("msg").textContent = "Thi·∫øu token tr√™n URL. V√≠ d·ª•: qr.html?token=QRXXXXX";
    return;
  }
  $("code").textContent = token;

  try{
    const r = await window.qrFactory.apiGet(`/api/scan?token=${encodeURIComponent(token)}`);
    if(!r.ok) throw new Error(r.error || "scan failed");
    const d = r.data || {};
    $("product").textContent = d.product_name || "-";
    $("batch").textContent = d.batch_serial || "-";
    $("mfg").textContent = d.mfg_date || "-";
    $("exp").textContent = d.exp_date || "-";
    $("note").textContent = d.note_extra || "-";
    $("status").textContent = d.status || "-";
    $("updated").textContent = d.updated_at || "-";
    $("msg").textContent = "";
  }catch(e){
    $("msg").textContent = "Kh√¥ng t√¨m th·∫•y / l·ªói: " + (e.message||e);
  }
}
document.addEventListener("DOMContentLoaded", run);
</script>
</body>
</html>
